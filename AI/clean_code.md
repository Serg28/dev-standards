# Правила чистого кода для ИИ

## Общие принципы

* **Правило:** Код должен быть написан так, чтобы его мог легко понять любой член команды.

## Форматирование

* **Правило:** Соблюдать единый стиль форматирования по всему проекту.
* **Правило:** Стиль кода должен соответствовать стандарту **PER**, который основан на PSR-1, PSR-2 и PSR-12.

## "Магические числа"

* **Правило:** Запрещено использовать числовые литералы ("магические числа") напрямую в коде.
* **Правило:** Вместо чисел использовать именованные константы или перечисления (Enums).
    * **Пример:** ✅ `if ($status === self::STATUS_ACTIVE)` / ❌ `if ($status === 1)`

## Минимизация вложенности

* **Правило:** Избегать использования оператора `else`. Вместо него применять ранние возвраты (early returns).
* **Пример:**
    ```php
    // ✅ Правильно
    public function isAllowed(User $user): bool
    {
        if ($user->isBanned()) {
            return false;
        }

        return true;
    }

    // ❌ Неправильно
    public function isAllowed(User $user): bool
    {
        if (!$user->isBanned()) {
            return true;
        } else {
            return false;
        }
    }
    ```

## "Счастливый путь" (Happy Path)

* **Правило:** Позитивный сценарий выполнения функции должен располагаться на основном уровне вложенности. Проверки на ошибки и исключения должны выполняться в начале функции.
* **Пример:**
    ```php
    // ✅ Правильно
    public function process(Data $data): void
    {
        if (! $data->isValid()) {
            throw new InvalidDataException();
        }

        // Основная логика здесь
    }

    // ❌ Неправильно
    public function process(Data $data): void
    {
        if ($data->isValid()) {
            // Основная логика здесь
        } else {
            throw new InvalidDataException();
        }
    }
    ```

## Архитектурные паттерны

*   **Правило:** Логика должна быть разделена по следующим классам:
    *   **Controller:** Принимает HTTP-запрос, вызывает Service/Action, возвращает ответ. Логика отсутствует.
    *   **DTO (Data Transfer Object):** Передаёт структурированные данные между слоями. Создаётся из `FormRequest`.
    *   **Action:** Выполняет одну, простую, атомарную операцию.
    *   **Service:** Оркестрирует сложный, многошаговый бизнес-процесс. Может вызывать Actions.
    *   **Query Scopes:** Использовать для инкапсуляции сложных, повторяющихся запросов к БД на уровне моделей Eloquent. Паттерн Repository не используется.

## Статические методы

*   **Правило:** Запрещено использовать статические методы для бизнес-логики или методов, имеющих зависимости. Разрешено только для stateless-хелперов и фабричных методов (например, `DTO::fromRequest()`).

## Принципы SOLID

*   **S (Single Responsibility):** Класс должен иметь только одну ответственность. `Controller` отвечает за HTTP, `Service` — за бизнес-логику.
*   **O (Open/Closed):** Код должен быть открыт для расширения (через создание новых классов), но закрыт для изменения.
*   **L (Liskov Substitution):** Подклассы должны быть взаимозаменяемы со своими родительскими классами/интерфейсами.
*   **I (Interface Segregation):** Использовать много маленьких, специфических интерфейсов вместо одного большого.
*   **D (Dependency Inversion):** Зависеть от абстракций (интерфейсов), а не от конкретных реализаций. Внедрять зависимости через конструктор.

## Итог

* Код должен быть последовательным, читаемым и простым для понимания.
* Минимизация вложенности и явное именование значений — ключевые практики чистого кода.
* Соблюдение архитектурных паттернов и принципов SOLID обязательно.
